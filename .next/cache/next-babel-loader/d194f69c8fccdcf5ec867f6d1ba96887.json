{"ast":null,"code":"var __jsx = React.createElement;\nimport Head from \"next/head\";\nimport Link from \"next/link\";\nimport AV from \"leancloud-storage\";\nimport dayjs from \"dayjs\";\nimport React, { useState, useEffect } from \"react\";\nimport { getMenusList } from \"src/service/menu\";\nimport { getProfileList } from \"src/service/profile\";\nimport { getMyUserInfo, createUserInfo } from \"src/service/user\";\nimport styles from \"./index.module.scss\";\nimport Nav from \"../Nav\";\nComponents.defaultProps = {\n  onChange: () => {}\n};\n\nfunction Components(props) {\n  const {\n    0: menus,\n    1: setmenus\n  } = useState(null);\n  const {\n    0: profile,\n    1: setprofile\n  } = useState(null);\n  const {\n    0: curUserInfo,\n    1: setcurUserInfo\n  } = useState(null);\n\n  const handleInit = async () => {\n    try {\n      await getData(\"CMS_Menus\", getMenusList, setmenus);\n      await getData(\"CMS_Profile\", getProfileList, setprofile);\n      await getData(\"CMS_UserInfo\", getMyUserInfo, setcurUserInfo);\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const getData = async (keyname, func, setFunc) => {\n    // 获取菜单\n    const local_data = sessionStorage.getItem(keyname);\n\n    if (local_data) {\n      setFunc(JSON.parse(local_data));\n    } else {\n      const res = await func();\n\n      if (res) {\n        setFunc(JSON.parse(JSON.stringify(res)));\n        sessionStorage.setItem(keyname, JSON.stringify(res));\n      } else {\n        // 如果是CMS_UserInfo 则创建userinfo\n        if (keyname === \"CMS_UserInfo\" && AV.User.current()) {\n          await createUserInfo();\n          await getData(\"CMS_UserInfo\", getMyUserInfo, setcurUserInfo);\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    handleInit();\n  }, []);\n  useEffect(() => {\n    props.onChange && props.onChange({\n      menus,\n      profile,\n      userinfo: curUserInfo\n    });\n  }, [menus, profile, curUserInfo]);\n  return __jsx(\"div\", {\n    className: styles.container\n  }, menus && profile && __jsx(Nav, {\n    menus: menus.value,\n    profile: profile,\n    userinfo: curUserInfo\n  }), __jsx(\"div\", {\n    className: styles.body\n  }, props.children), profile && __jsx(\"footer\", {\n    className: styles.footer\n  }, __jsx(\"div\", {\n    className: styles.footer_content\n  })));\n}\n\nexport default Components;","map":null,"metadata":{},"sourceType":"module"}